(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,n,r,o,c){var a=t.name,i=t.link,u=t.likes,s=t.ownerId,l=t.cardId,d=e.cloneNode(!0).firstElementChild,p=d.querySelector(".card__image"),f=d.querySelector(".card__delete-button"),m=d.querySelector(".card__title"),_=d.querySelector(".card__like-button"),y=d.querySelector(".card__like-description");return p.src=i,p.alt=a,m.textContent=a,y.textContent=u.length,s!==o?f.classList.add("card__delete-button_inactive"):f.addEventListener("click",(function(){return c(d,l)})),_.addEventListener("click",(function(){return n(l,u,y,_,o)})),p.addEventListener("click",(function(){return r(a,i)})),d}var n={popupElement:".popup",inputElement:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};function r(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),o.classList.remove(r),o.textContent=""}function o(e,t,n){t&&(function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!0,t.classList.add(n)):(t.disabled=!1,t.classList.remove(n)))}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",i),e.classList.contains("popup_type_edit")||Array.from(e.querySelectorAll(n.inputElement)).forEach((function(e){e.value=""}))}function a(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i),function(e,t){var n=Array.from(e.querySelectorAll(t.inputElement)),c=e.querySelector(t.submitButtonSelector);n.forEach((function(n){r(e,n,t.inputErrorClass,t.errorClass)})),o(n,c,t.inactiveButtonClass)}(e,n)}function i(e){var t=document.querySelector(".popup_is-opened");"Escape"===e.key&&a(t)}var u,s,l,d={baseUrl:"https://nomoreparties.co/v1/wff-cohort-23",headers:{authorization:"10b7c520-7611-4736-ac14-58b5cfbecdab","Content-Type":"application/json"}},p=document.querySelector(".profile__edit-button"),f=document.querySelector(".popup_type_edit"),m=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),y=document.querySelector(".profile__image"),v=document.querySelector(".profile__add-button"),h=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),S=b.querySelector(".popup__image"),k=b.querySelector(".popup__caption"),q=document.querySelector(".popup_type_new-avatar"),E=document.querySelector(".popup__confirm"),C=document.querySelector(".popup__confirm_button"),L=document.forms["edit-profile"],g=L.querySelector(".popup__input_type_name"),j=L.querySelector(".popup__input_type_description"),A=L.querySelector(".popup__button_edit-profile"),w=document.forms["new-place"],x=w.querySelector(".popup__input_type_card-name"),I=w.querySelector(".popup__input_type_url"),P=w.querySelector(".popup__button_add-new-card"),T=document.forms["new-avatar"],U=T.querySelector(".popup__input_type_avatar_url"),B=T.querySelector(".popup__button_new-avatar"),O=document.querySelector(".places__list"),D=document.querySelectorAll(".popup");function N(e,t){if(e){if("string"==typeof e)return J(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function M(e,t){S.alt=e,S.src=t,k.textContent=e,c(b)}function H(e,t){u=e,s=t,c(E)}function V(e,t,n,r,o){var c=t.some((function(e){return e._id===o})),a=c?function(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e):function(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:d.headers,body:JSON.stringify({})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e);a.then((function(e){var a;t.length=0,t.push.apply(t,function(e){if(Array.isArray(e))return J(e)}(a=e.likes)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(a)||N(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n.textContent=e.likes.length,(c=e.likes.some((function(e){return e._id===o})))?r.classList.add("card__like-button_is-active"):r.classList.remove("card__like-button_is-active")})).catch((function(e){console.error(e)}))}p.addEventListener("click",(function(){g.value=m.textContent,j.value=_.textContent,A.classList.add(n.inactiveButtonClass),c(f)})),y.addEventListener("click",(function(){return c(q)})),L.addEventListener("submit",(function(e){e.preventDefault();var t=g.value,n=j.value;m.textContent=t,_.textContent=n,function(e,t){fetch("".concat(d.baseUrl,"/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t,n),a(f)})),T.addEventListener("submit",(function(e){e.preventDefault();var t=U.value;B.textContent="Сохранение...",function(e){return fetch("".concat(d.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(){y.style.backgroundImage="url(".concat(t,")")})).catch((function(e){console.error(e)})).finally((function(){B.textContent="Сохранить",a(q)}))})),v.addEventListener("click",(function(){return c(h)})),w.addEventListener("submit",(function(e){e.preventDefault();var n,r,o,c=x.value,i=I.value;P.textContent="Сохранение...",(n={name:c,link:i},r=n.name,o=n.link,fetch("".concat(d.baseUrl,"/cards"),{method:"POST",headers:d.headers,body:JSON.stringify({name:r,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var n=t({name:e.name,link:e.link,likes:e.likes,ownerId:e.owner._id,cardId:e._id},V,M,l,H);O.prepend(n)})).finally((function(){P.textContent="Сохранить",x.value="",I.value="",a(h)})).catch((function(e){console.error("Ошибка добавления карточки: ".concat(e))}))})),C.addEventListener("click",(function(){var e;C.textContent="Удаление...",(e=s,fetch("".concat(d.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){u?u.remove():console.error("cardToDelete не определена"),C.textContent="Да",a(E)})).catch((function(e){console.error("Ошибка при удалении карточки: ".concat(e))}))})),D.forEach((function(e){e.addEventListener("click",(function(t){(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&a(e)}))})),Promise.all([fetch("".concat(d.baseUrl,"/users/me"),{headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(d.baseUrl,"/cards"),{headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,s=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return i}}(n,r)||N(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];m.textContent=c.name,_.textContent=c.about,y.style.backgroundImage="url(".concat(c.avatar,")"),function(e,n,r,o){e.forEach((function(e){var c=t({name:e.name,link:e.link,likes:e.likes,ownerId:e.owner._id,cardId:e._id},V,n,r,o);e.likes.some((function(e){return e._id===r}))&&c.querySelector(".card__like-button").classList.add("card__like-button_is-active"),O.appendChild(c)}))}(a,M,l=c._id,H)})).catch((function(e){return console.error(e)})),function(e){Array.from(document.querySelectorAll(e.popupElement)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputElement)),c=e.querySelector(t.submitButtonSelector);o(n,c,t.inactiveButtonClass),n.forEach((function(a){a.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?r(e,t,n,o):function(e,t,n,r,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),c.textContent=n,c.classList.add(o)}(e,t,t.validationMessage,n,o)}(e,a,t.inputErrorClass,t.errorClass),o(n,c,t.inactiveButtonClass)}))}))}(t,e)}))}(n)})();